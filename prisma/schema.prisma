generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Estados {
  PENDIENTE
  EN_PROCESO
  RESUELTO
}

model Cliente {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  email       String     @unique
  contraseña String
  nombre      String
  telefono    String
  role        String
  proyectos   Proyecto[] @relation("ProyectoACliente")
  cambiosEstado CambioEstado[] @relation("ClienteACambioEstado")

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model Empleado {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  email         String         @unique
  contraseña   String
  nombre        String
  telefono      String
  role          String
  areaId        String?        @db.ObjectId
  area          Area?          @relation("EmpleadosEnArea", fields: [areaId], references: [id])
  cambiosEstado CambioEstado[] @relation("EmpleadoACambioEstado")

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model Area {
  id           String         @id @default(auto()) @map("_id") @db.ObjectId
  nombre       String
  descripcion  String?
  cambioEstado CambioEstado[]
  empleados    Empleado[]     @relation("EmpleadosEnArea")
  
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  deletedAt    DateTime?
}

model Proyecto {
  id             String @id @default(auto()) @map("_id") @db.ObjectId
  clienteId      String @db.ObjectId
  tipoProyectoId String @db.ObjectId

  nombre      String
  descripcion String?
  reclamos    Reclamo[]
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?

  cliente      Cliente      @relation("ProyectoACliente", fields: [clienteId], references: [id])
  tipoProyecto TipoProyecto @relation("ProyectoATipoProyecto", fields: [tipoProyectoId], references: [id])
}

model TipoProyecto {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  nombre      String
  descripcion String?
  proyectos   Proyecto[] @relation("ProyectoATipoProyecto")

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  deletedAt   DateTime?
}

model Reclamo {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  tipoReclamoId String         @db.ObjectId
  proyectoId    String         @db.ObjectId

  estado        Estados
  prioridad     String
  criticidad    String
  archivo       String?
  descripcion   String
  cambioEstado  CambioEstado[]

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  deletedAt     DateTime?

  tipoReclamo   TipoReclamo    @relation(fields: [tipoReclamoId], references: [id])
  proyecto      Proyecto       @relation(fields: [proyectoId], references: [id])
}

model TipoReclamo {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  nombre      String
  descripcion String?
  reclamos    Reclamo[]
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
}

model CambioEstado {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  reclamoId   String    @db.ObjectId
  empleadoId  String?   @db.ObjectId
  clienteId   String?   @db.ObjectId

  reclamo     Reclamo   @relation(fields: [reclamoId], references: [id])
  areaId      String    @db.ObjectId
  area        Area      @relation(fields: [areaId], references: [id])
  fechaInicio DateTime  @default(now())
  fechaFin    DateTime?
  descripcion String?
  estado      Estados

  
  empleado    Empleado? @relation("EmpleadoACambioEstado", fields: [empleadoId], references: [id])
  cliente     Cliente?  @relation("ClienteACambioEstado", fields: [clienteId], references: [id])
}